<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V-Ges</title>
    <link rel="stylesheet" href="{{ site.baseurl }}/assets/css/viges-style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
     <style>
        /* Mengatur agar video tidak bisa di-fullscreen secara default oleh browser */
        video::-webkit-media-controls-fullscreen-button {
            display: none !important;
        }
        video::-webkit-media-controls-play-button {
            display: none !important;
        }
        video::-webkit-media-controls-timeline {
            display: none !important;
        }
        video::-webkit-media-controls-current-time-display {
            display: none !important;
        }
        video::-webkit-media-controls-time-remaining-display {
            display: none !important;
        }
        video::-webkit-media-controls-mute-button {
            display: none !important;
        }
        video::-webkit-media-controls-volume-slider {
            display: none !important;
        }
        /* Jika Anda ingin menyembunyikan semua kontrol bawaan */
        video::-webkit-media-controls {
            display: none !important;
        }
        video::controls {
             display: none !important;
        }
    </style>
</head>
<body>
    <div class="tiktok-container">
        <header class="tiktok-header">
            <div class="logo">
                <h1>ViGes</h1>
            </div>
            <div class="search-bar">
                <input type="text" placeholder="Cari...">
                <i class="fas fa-search"></i>
            </div>
        </header>

        <main class="tiktok-main-content">
            {{ content }}
        </main>

        <footer class="tiktok-footer-nav">
            <div class="nav-item active">
                <i class="fas fa-home"></i>
                <span>Beranda</span>
            </div>
            <div class="nav-item">
                <i class="fas fa-compass"></i>
                <span>Jelajahi</span>
            </div>
            <div class="nav-item add-button">
                <i class="fas fa-plus"></i>
            </div>
            <div class="nav-item">
                <i class="fas fa-inbox"></i>
                <span>Kotak Masuk</span>
            </div>
            <div class="nav-item">
                <i class="fas fa-user"></i>
                <span>Profil</span>
            </div>
        </footer>
    </div>
    <script>
        // Memuat Wistia API secara asynchronous
        window._wq = window._wq || [];
        _wq.push({ id: "_all", onReady: function(video) {
            // Video Wistia sudah siap, bisa dilakukan inisialisasi jika perlu
        }});

        document.addEventListener('DOMContentLoaded', () => {
            const videoItems = document.querySelectorAll('.video-item');
            const mainContent = document.querySelector('.tiktok-main-content');
            let activeVideo = null; // Menyimpan referensi video yang sedang aktif

            // Fungsi untuk memutar video Wistia
            function playWistiaVideo(iframeId) {
                _wq.push({
                    id: iframeId,
                    onReady: function(video) {
                        video.play();
                        video.mute(); // Mulai dalam keadaan muted
                        console.log(`Playing and muting video: ${iframeId}`);
                    }
                });
            }

            // Fungsi untuk menghentikan video Wistia
            function pauseWistiaVideo(iframeId) {
                _wq.push({
                    id: iframeId,
                    onReady: function(video) {
                        video.pause();
                        video.time(0); // Kembali ke awal video
                        console.log(`Pausing video: ${iframeId}`);
                    }
                });
            }

            const observerOptions = {
                root: mainContent, // Mengamati di dalam main-content
                rootMargin: '0px',
                threshold: 0.8 // Video akan dianggap 'terlihat' jika 80% dari video berada dalam viewport
            };

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    const videoPlayer = entry.target.querySelector('.video-player iframe');
                    if (!videoPlayer) return;

                    const iframeId = videoPlayer.id;

                    if (entry.isIntersecting) {
                        // Jika video ini terlihat
                        if (activeVideo && activeVideo !== iframeId) {
                            // Hentikan video sebelumnya yang aktif (jika ada dan berbeda)
                            pauseWistiaVideo(activeVideo);
                        }
                        playWistiaVideo(iframeId);
                        activeVideo = iframeId; // Tetapkan video ini sebagai yang aktif
                    } else {
                        // Jika video ini tidak terlihat lagi
                        if (activeVideo === iframeId) {
                            // Jika video yang tidak terlihat adalah video yang sedang aktif, hentikan
                            pauseWistiaVideo(iframeId);
                            activeVideo = null; // Setel ulang activeVideo
                        }
                    }
                });
            }, observerOptions);

            // Mulai mengamati setiap video-item
            videoItems.forEach(item => {
                observer.observe(item);
            });

            // Putar video pertama secara manual saat halaman dimuat (jika ada)
            // Ini untuk memastikan ada video yang diputar saat pertama kali landing
            if (videoItems.length > 0) {
                const firstVideoPlayer = videoItems[0].querySelector('.video-player iframe');
                if (firstVideoPlayer) {
                    playWistiaVideo(firstVideoPlayer.id);
                    activeVideo = firstVideoPlayer.id;
                }
            }
        });
    </script>
</body>
</html>
