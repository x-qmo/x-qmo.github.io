<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V-Ges</title>
    <link rel="stylesheet" href="{{ site.baseurl }}/assets/css/viges-style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
     <style>
        /* Mengatur agar video tidak bisa di-fullscreen secara default oleh browser */
        video::-webkit-media-controls-fullscreen-button {
            display: none !important;
        }
        video::-webkit-media-controls-play-button {
            display: none !important;
        }
        video::-webkit-media-controls-timeline {
            display: none !important;
        }
        video::-webkit-media-controls-current-time-display {
            display: none !important;
        }
        video::-webkit-media-controls-time-remaining-display {
            display: none !important;
        }
        video::-webkit-media-controls-mute-button {
            display: none !important;
        }
        video::-webkit-media-controls-volume-slider {
            display: none !important;
        }
        /* Jika Anda ingin menyembunyikan semua kontrol bawaan */
        video::-webkit-media-controls {
            display: none !important;
        }
        video::controls {
             display: none !important;
        }
    </style>
</head>
<body>
    <div class="tiktok-container">
        <header class="tiktok-header">
            <div class="logo">
                <h1>ViGes</h1>
            </div>
            <div class="search-bar">
                <input type="text" placeholder="Cari...">
                <i class="fas fa-search"></i>
            </div>
        </header>

        <main class="tiktok-main-content">
            {{ content }}
        </main>

        <footer class="tiktok-footer-nav">
            <div class="nav-item active">
                <i class="fas fa-home"></i>
                <span>Beranda</span>
            </div>
            <div class="nav-item">
                <i class="fas fa-compass"></i>
                <span>Jelajahi</span>
            </div>
            <div class="nav-item add-button">
                <i class="fas fa-plus"></i>
            </div>
            <div class="nav-item">
                <i class="fas fa-inbox"></i>
                <span>Kotak Masuk</span>
            </div>
            <div class="nav-item">
                <i class="fas fa-user"></i>
                <span>Profil</span>
            </div>
        </footer>
    </div>
    <script>
        // Inisialisasi Wistia API secara asynchronous
        // Ini adalah bagian penting yang memungkinkan Anda mengontrol pemutar Wistia dengan JavaScript.
        window._wq = window._wq || [];

        // Pastikan DOM sudah dimuat sebelum menjalankan skrip
        document.addEventListener('DOMContentLoaded', () => {
            const videoItems = document.querySelectorAll('.video-item');
            const mainContent = document.querySelector('.tiktok-main-content');
            let activeVideoId = null; // Menyimpan ID video Wistia yang sedang aktif

            // Fungsi untuk memutar video Wistia
            function playWistiaVideo(iframeId) {
                // Gunakan _wq.push untuk berinteraksi dengan pemutar Wistia
                _wq.push({
                    id: iframeId,
                    onReady: function(video) {
                        video.play();
                        video.mute(); // Mulai video dalam keadaan muted (disarankan untuk autoplay)
                        console.log(`Playing and muting video: ${iframeId}`);
                    }
                });
            }

            // Fungsi untuk menghentikan dan mereset video Wistia
            function pauseWistiaVideo(iframeId) {
                _wq.push({
                    id: iframeId,
                    onReady: function(video) {
                        video.pause();
                        video.time(0); // Atur ulang waktu video ke awal
                        console.log(`Pausing video: ${iframeId}`);
                    }
                });
            }

            // Opsi untuk Intersection Observer
            const observerOptions = {
                root: mainContent, // Element yang akan menjadi viewport (scroll container)
                rootMargin: '0px',
                threshold: 0.7 // Video akan dianggap 'terlihat' jika 70% dari video berada dalam viewport
            };

            // Buat Intersection Observer
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    const videoPlayerIframe = entry.target.querySelector('.video-player iframe');
                    if (!videoPlayerIframe) return; // Pastikan ada iframe di dalam video-item

                    const currentVideoId = videoPlayerIframe.id;

                    if (entry.isIntersecting) {
                        // Jika video ini masuk ke dalam viewport (terlihat)
                        if (activeVideoId && activeVideoId !== currentVideoId) {
                            // Jika ada video lain yang sedang aktif, jeda video tersebut
                            pauseWistiaVideo(activeVideoId);
                        }
                        // Putar video yang baru terlihat
                        playWistiaVideo(currentVideoId);
                        activeVideoId = currentVideoId; // Tetapkan video ini sebagai yang aktif
                    } else {
                        // Jika video ini keluar dari viewport (tidak terlihat)
                        if (activeVideoId === currentVideoId) {
                            // Jika video yang keluar adalah video yang sedang aktif, jeda video tersebut
                            pauseWistiaVideo(currentVideoId);
                            activeVideoId = null; // Reset activeVideoId
                        }
                    }
                });
            }, observerOptions);

            // Mulai mengamati setiap elemen video-item
            videoItems.forEach(item => {
                observer.observe(item);
            });

            // Opsional: Putar video pertama secara otomatis saat halaman pertama kali dimuat
            // Ini untuk memastikan ada video yang langsung diputar tanpa perlu scroll
            if (videoItems.length > 0) {
                const firstVideoPlayer = videoItems[0].querySelector('.video-player iframe');
                if (firstVideoPlayer) {
                    playWistiaVideo(firstVideoPlayer.id);
                    activeVideoId = firstVideoPlayer.id;
                }
            }
        });
    </script>
</body>
</html>
